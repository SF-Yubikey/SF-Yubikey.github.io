---
title: POST Requests
date: 2020-10-28 14:20:00 -05:00
position: 3
---

# POST Request Documentation

A collection of all the POST requests captured from the time one logs on and is prompted to change their password to when the authenticator is successfully applied can be found [here](https://www.getpostman.com/collections/3077f5d7a1acbee482b9). The collection organizes the POST requests into their roles, such as those used to apply an authenticator to the account. The POST requests used in TOTP enrollment process are found in the TOTP Enrollment folder, which is a subfolder of the Adding Authenticator Related folder.

The three POST requests sent in the TOTP enrollment process are InitializeMobileAppRegistration, AddSecurityInfo, and VerifySecurityInfo. All three requests use JSON for their bodies.

InitializeMobileAppRegistration occurs when one clicks the next button in the screenshot below. InitializeMobileAppRegistration’s body contains the JSON name value pair securityInfoType: Integer. securityInfoType’s value is set to 2 if one chose to use the Microsoft authenticator and 3 if they chose to use a third-party authenticator.

![InitializeMobileAppRegistration.png](/uploads/InitializeMobileAppRegistration.png)

AddSecurityInfo occurs when one clicks the next button in the screenshot below. AddSecurityInfo contains the JSON name pairs of Type: Integer and Data: {SecertKey: String, affinityRegion: null}. Type corresponds to the securityInfoType found in InitializeMobileAppRegistration. SecertKey contains the secret key used by the authenticator application and is displayed in the screenshot below. affinityRegion likely corresponds the affinity region of the user; however, during our testing, it was always set to null when using a third-party authenticator.

![AddSecurityInfo.png](/uploads/AddSecurityInfo.png)

VerifySecurityInfo occurs when one clicks next in the screenshot below. VerifySecurityInfo contains the JSON name value pairs of Type: Integer, VerificationContext: String, and VerificationData: String. Type corresponds to the securityInfoType found in the initializeMobileAppRegistration.  VerificationContext’s string value is a string that matches the VerificationContext sent in the response to the AddSecurityInfo POST request. If one uses a third-party authenticator, VerificationData contains the six-digit TOTP string generated by the authenticator. If one uses the Microsoft authenticator application, VerificationData’s value is set to null, and the VerifySecurityInfo request is repeatedly sent until one interacts with the Microsoft authenticator application on their phone.

![VerifySecurityInfo.png](/uploads/VerifySecurityInfo.png)


## Replaying the POST requests

We attempted to replay the post request that replied with the TOTP secret so that we could automate the enrollment process, but ran into problems with replaying the request. In the browser, during the enrollment process, the following is the response:

`)]}',
`\
`{"RegistrationType":3,"QrCode":"(base64 of QR code png trimmed for brevity)","ActivationCode":null,"Url":null,"SameDeviceUrl":"","AccountName":"SF Insider:cjiang@sfinsider.onmicrosoft.com","SecretKey":"zdndcldvxwmb7nfv","AffinityRegion":null}`

There is a clearly identifiable SecretKey in the JSON that can be used in the challenge response to enroll the MFA method. However, when replaying the request, with the same headers and body to the same web server just seconds afterwards, 

![unknown.png](/uploads/unknown.png)